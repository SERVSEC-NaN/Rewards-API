#!/usr/bin/env ruby
# frozen_string_literal: true

require 'yaml'
require_relative '../config/require_app'
require_relative '../config/environment'
require_app '../app/lib'

APP = Rewards::Api.freeze
DB_PATH = 'sqlite://app/db/store'

def generate_secrets
  {
    'development' => {
      'DATABASE_URL' => "#{DB_PATH}/development.db",
      'DB_KEY' => SecureDB.generate_key.to_s

    },

    'test' => {
      'DATABASE_URL' => "#{DB_PATH}/test.db",
      'DB_KEY' => SecureDB.generate_key.to_s
    }
  }
end

def newkeys
  if APP.environment == :production
    p 'Cannot change secrets in production environment!'
    exit
  end

  File.open('config/secrets.yml', 'w') do |file|
    file.write YAML.dump generate_secrets
  end
end

newkeys if __FILE__ == $PROGRAM_NAME
